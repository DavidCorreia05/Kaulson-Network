<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kaulson Network | Oficial</title>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getFirestore, doc, setDoc, onSnapshot, collection, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyA51GrwiUnvZVbv4Cvz-M", 
        authDomain: "kaulson-network.firebaseapp.com",
        projectId: "kaulson-network",
        storageBucket: "kaulson-network.firebasestorage.app",
        messagingSenderId: "756558405529",
        appId: "1:756558405529:web:999f6fa"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // GARANTIR ID √öNICO (Resolve o erro 'undefined')
      let userId = localStorage.getItem('kson_id');
      if(!userId || userId === "undefined") {
          userId = 'User_' + Math.floor(Math.random() * 89999 + 10000);
          localStorage.setItem('kson_id', userId);
      }

      // FUN√á√ÉO DE GRAVA√á√ÉO CORRIGIDA
      window.saveToCloud = async (novoSaldo) => {
        try {
          await setDoc(doc(db, "ranking", userId), {
            id: userId,
            saldo: novoSaldo,
            lastUpdate: Date.now()
          }, { merge: true });
        } catch (e) { console.error("Erro Cloud:", e); }
      };

      // ATUALIZA√á√ÉO DO RANKING EM TEMPO REAL
      onSnapshot(query(collection(db, "ranking"), orderBy("saldo", "desc"), limit(10)), (snap) => {
        const list = document.getElementById('rankList');
        if(list) {
            list.innerHTML = "";
            snap.forEach(d => {
                const data = d.data();
                list.innerHTML += `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #222;">
                    <span style="color:#888;">${data.id || 'An√≥nimo'}</span>
                    <span style="color:#d4af37; font-weight:bold;">${Number(data.saldo).toFixed(5)} $KSON</span>
                </div>`;
            });
        }
      });
    </script>

    <style>
        body { background: #000; color: #fff; font-family: sans-serif; text-align: center; margin: 0; }
        .header { padding: 40px 20px; background: #111; border-bottom: 2px solid #222; }
        .bal { font-size: 50px; font-weight: bold; color: #d4af37; margin: 10px 0; }
        .stats { display: flex; justify-content: center; gap: 10px; padding: 20px; }
        .box { background: #111; padding: 15px; border-radius: 10px; border: 1px solid #222; flex: 1; max-width: 160px; }
        .k-btn { 
            width: 180px; height: 180px; border-radius: 50%; border: 8px solid #222;
            background: radial-gradient(circle, #f1d367, #d4af37);
            font-size: 70px; font-weight: bold; cursor: pointer; margin: 30px 0;
            box-shadow: 0 0 30px rgba(212,175,55,0.2);
        }
        .k-btn:active { transform: scale(0.9); }
        .card { background: #111; margin: 20px; padding: 20px; border-radius: 15px; border: 1px solid #222; text-align: left; }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-size: 12px; color: #666;">SALDO ESTIMADO</div>
        <div class="bal" id="visor">0.00000</div>
        <div id="tagName" style="color:#d4af37; font-weight:bold;"></div>
    </div>

    <div class="stats">
        <div class="box"><small style="color:#666">MAX SUPPLY</small><br>90M</div>
        <div class="box"><small style="color:#666">VELOCIDADE</small><br>2.0/h</div>
    </div>

    <button class="k-btn" id="btnMine">K</button>

    <div class="card">
        <b style="color:#d4af37; font-size:14px;">üèÜ RANKING DE CONFIAN√áA</b>
        <div id="rankList" style="margin-top:15px;">A ligar √† rede...</div>
    </div>

    <script>
        let saldo = parseFloat(localStorage.getItem('kson_v6_bal')) || 0;
        const visor = document.getElementById('visor');
        const tagName = document.getElementById('tagName');
        
        // Mostrar o ID correto no topo
        tagName.innerText = localStorage.getItem('kson_id');
        visor.innerText = saldo.toFixed(5);

        document.getElementById('btnMine').onclick = () => {
            saldo += 0.00055; // Protocolo 2.0/h
            visor.innerText = saldo.toFixed(5);
            localStorage.setItem('kson_v6_bal', saldo);
            
            // Enviar para a nuvem
            if(window.saveToCloud) window.saveToCloud(saldo);
        };
    </script>
</body>
</html>
