<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kaulson Network | Minera√ß√£o Oficial</title>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getFirestore, doc, setDoc, onSnapshot, collection, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyA51GrwiUnvZVbv4Cvz-M", 
        authDomain: "kaulson-network.firebaseapp.com",
        projectId: "kaulson-network",
        storageBucket: "kaulson-network.firebasestorage.app",
        messagingSenderId: "756558405529",
        appId: "1:756558405529:web:999f6fa"
      };

      // Inicializa√ß√£o Segura
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Gerador de ID An√≥nimo para integridade do utilizador
      if(!localStorage.getItem('kson_user_id')) {
          localStorage.setItem('kson_user_id', 'Minerador_' + Math.floor(Math.random() * 9000 + 1000));
      }
      const userId = localStorage.getItem('kson_user_id');

      // Fun√ß√£o de Grava√ß√£o com Verifica√ß√£o de Erro
      window.saveData = async (valor) => {
        try {
          await setDoc(doc(db, "ranking", userId), {
            id: userId,
            saldo: valor,
            timestamp: Date.now()
          }, { merge: true });
        } catch (error) {
          console.error("Erro na Blockchain/Firebase:", error);
        }
      };

      // Listener do Ranking em Tempo Real
      const q = query(collection(db, "ranking"), orderBy("saldo", "desc"), limit(10));
      onSnapshot(q, (snapshot) => {
        const rankingDiv = document.getElementById('rankList');
        if (rankingDiv) {
            rankingDiv.innerHTML = "";
            snapshot.forEach((doc) => {
                const data = doc.data();
                rankingDiv.innerHTML += `
                    <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #222; font-family:monospace;">
                        <span style="color:#aaa;">${data.id}</span>
                        <span style="color:#d4af37; font-weight:bold;">${data.saldo.toFixed(5)} $KSON</span>
                    </div>`;
            });
        }
      });
    </script>

    <style>
        body { background: #000; color: #fff; font-family: sans-serif; text-align: center; margin: 0; overflow-x: hidden; }
        .header { padding: 30px; background: #111; border-bottom: 2px solid #d4af37; }
        .balance-label { font-size: 14px; color: #888; text-transform: uppercase; }
        .balance-value { font-size: 45px; font-weight: bold; color: #d4af37; margin-top: 5px; }
        .mine-container { padding: 50px 0; }
        .k-btn { 
            width: 180px; height: 180px; border-radius: 50%; border: 10px solid #222;
            background: linear-gradient(145deg, #d4af37, #b8962e);
            font-size: 70px; color: #000; font-weight: bold; cursor: pointer;
            box-shadow: 0 0 40px rgba(212,175,55,0.2);
        }
        .k-btn:active { transform: scale(0.92); }
        .card { width: 85%; max-width: 400px; background: #111; margin: 20px auto; padding: 20px; border-radius: 15px; border: 1px solid #222; text-align: left; }
        .card-title { color: #d4af37; font-size: 14px; font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="balance-label">Saldo em Minera√ß√£o</div>
        <div class="balance-value" id="mainBalance">0.00000</div>
    </div>

    <div class="mine-container">
        <button class="k-btn" id="mineAction">K</button>
        <p id="status" style="color:#444; margin-top:20px;">TOQUE PARA INICIAR</p>
    </div>

    <div class="card">
        <div class="card-title">üèÜ RANKING GLOBAL (AN√ìNIMO)</div>
        <div id="rankList">A ligar √† rede...</div>
    </div>

    <script>
        let currentBalance = parseFloat(localStorage.getItem('kson_total')) || 0;
        const display = document.getElementById('mainBalance');
        const status = document.getElementById('status');

        display.innerText = currentBalance.toFixed(5);

        document.getElementById('mineAction').onclick = () => {
            // Protocolo de Minera√ß√£o $KSON
            currentBalance += 0.00055;
            display.innerText = currentBalance.toFixed(5);
            
            // Salva localmente
            localStorage.setItem('kson_total', currentBalance);
            
            // Salva na Nuvem (Firebase)
            if (window.saveData) {
                window.saveData(currentBalance);
                status.innerText = "Sincronizado com a Rede";
                status.style.color = "#d4af37";
            }
        };
    </script>
</body>
</html>
