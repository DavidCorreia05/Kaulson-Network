<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kaulson Network | Protocolo Oficial</title>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getFirestore, doc, setDoc, onSnapshot, collection, query, orderBy, limit, getCountFromServer } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyA51GrwiUnvZVbv4Cvz-M", 
        authDomain: "kaulson-network.firebaseapp.com",
        projectId: "kaulson-network",
        storageBucket: "kaulson-network.firebasestorage.app",
        messagingSenderId: "756558405529",
        appId: "1:756558405529:web:999f6fa"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // ID Único e Anónimo
      if(!localStorage.getItem('kson_user_id')) {
          localStorage.setItem('kson_user_id', 'User_' + Math.floor(Math.random() * 89999 + 10000));
      }
      const userId = localStorage.getItem('kson_user_id');

      // --- LÓGICA DE ESCASSEZ (HALVING) ---
      window.obterTaxa = async () => {
        const coll = collection(db, "ranking");
        const snapshot = await getCountFromServer(coll);
        const totalUsers = snapshot.data().count;
        
        if (totalUsers <= 100000) return 0.000555; // 2.0 p/ hora
        if (totalUsers <= 500000) return 0.000277; // 1.0 p/ hora
        return 0.000138; // 0.5 p/ hora
      };

      window.saveData = async (valor) => {
        try {
          await setDoc(doc(db, "ranking", userId), {
            id: userId,
            saldo: valor,
            timestamp: Date.now()
          }, { merge: true });
        } catch (e) { console.error(e); }
      };

      // Ranking e Monitor de Rede
      onSnapshot(query(collection(db, "ranking"), orderBy("saldo", "desc"), limit(5)), (snap) => {
        const list = document.getElementById('rankList');
        list.innerHTML = "";
        snap.forEach(d => {
            const u = d.data();
            list.innerHTML += `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #222; font-size:13px;">
                <span style="color:#888;">${u.id}</span>
                <span style="color:#d4af37;">${u.saldo.toFixed(5)} $KSON</span>
            </div>`;
        });
      });
    </script>

    <style>
        :root { --gold: #d4af37; --bg: #000; --card: #111; }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; margin: 0; text-align: center; }
        .header { padding: 40px 20px; background: linear-gradient(to bottom, #111, #000); border-bottom: 1px solid #222; }
        .balance { font-size: 50px; font-weight: bold; color: var(--gold); margin: 10px 0; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 20px; }
        .stat-box { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid #222; }
        .stat-label { font-size: 10px; color: #666; text-transform: uppercase; margin-bottom: 5px; }
        .stat-val { font-size: 14px; font-weight: bold; color: #eee; }
        .mine-btn { 
            width: 180px; height: 180px; border-radius: 50%; border: 8px solid #222;
            background: radial-gradient(circle, #f1d367, #d4af37);
            font-size: 60px; font-weight: bold; cursor: pointer; margin: 30px 0;
            box-shadow: 0 0 30px rgba(212,175,55,0.1); transition: 0.3s;
        }
        .mine-btn:active { transform: scale(0.9); }
        .card { background: var(--card); margin: 0 20px 20px; padding: 20px; border-radius: 15px; text-align: left; border: 1px solid #222; }
        .card-title { color: var(--gold); font-size: 12px; font-weight: bold; margin-bottom: 15px; display: block; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-size: 12px; color:
