<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kaulson Network | Oficial v11</title>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getFirestore, doc, setDoc, onSnapshot, collection, query, orderBy, limit, where, getDocs, getCountFromServer } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyA51GrwiUnvZVbv4Cvz-M", 
        authDomain: "kaulson-network.firebaseapp.com",
        projectId: "kaulson-network",
        storageBucket: "kaulson-network.firebasestorage.app",
        messagingSenderId: "756558405529",
        appId: "1:756558405529:web:999f6fa"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // NOVO SISTEMA DE ID (LIMPO)
      let userId = localStorage.getItem('kson_id_v11') || 'USER_' + Math.floor(Math.random() * 89999 + 10000);
      localStorage.setItem('kson_id_v11', userId);

      // SINCRONIZA√á√ÉO COM A NOVA PASTA 'kaulson_v11_final'
      window.syncToCloud = async (saldo, isMining) => {
          try {
              await setDoc(doc(db, "kaulson_v11_final", userId), {
                  id: userId,
                  saldo: saldo,
                  active: isMining,
                  last: Date.now()
              }, { merge: true });
          } catch (e) { console.error(e); }
      };

      // RANKING EM TEMPO REAL (APENAS DA NOVA REDE)
      onSnapshot(query(collection(db, "kaulson_v11_final"), orderBy("saldo", "desc"), limit(10)), (snap) => {
          const list = document.getElementById('rankList');
          list.innerHTML = "";
          snap.forEach(d => {
              const u = d.data();
              list.innerHTML += `<div style="display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #222;">
                  <span style="${u.id===userId?'color:#d4af37;font-weight:bold;':''}">${u.id === userId ? 'VOC√ä' : u.id}</span>
                  <span style="color:#d4af37">${u.saldo.toFixed(5)} $KSON</span>
              </div>`;
          });
      });
    </script>

    <style>
        body { background: #000; color: #fff; font-family: -apple-system, sans-serif; text-align: center; margin: 0; }
        .header { padding: 45px 20px; border-bottom: 1px solid #222; background: #0a0a0a; }
        .bal { font-size: 55px; font-weight: bold; color: #d4af37; letter-spacing: -1px; }
        .k-btn { width: 190px; height: 190px; border-radius: 50%; border: 8px solid #222; background: #d4af37; font-size: 80px; font-weight: bold; cursor: pointer; margin: 30px 0; transition: 0.3s; }
        .k-btn.active { background: #111; color: #d4af37; border-color: #d4af37; animation: glow 2s infinite; }
        @keyframes glow { 0% { box-shadow: 0 0 5px #d4af37; } 50% { box-shadow: 0 0 20px #d4af37; } 100% { box-shadow: 0 0 5px #d4af37; } }
        .card { background: #111; margin: 15px; padding: 20px; border-radius: 18px; text-align: left; border: 1px solid #222; }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-size: 11px; color: #555; letter-spacing: 2px; margin-bottom: 5px;">SALDO ATUAL</div>
        <div class="bal" id="visor">0.00000</div>
    </div>

    <button class="k-btn" id="btnMine">K</button>

    <div class="card">
        <div id="statusTxt" style="font-weight: bold; font-size: 12px; color: #ff4444; letter-spacing: 1px;">SISTEMA OFFLINE</div>
        <div id="timer" style="font-size: 18px; margin-top: 5px; font-weight: 500;">Clique para iniciar 24h</div>
    </div>

    <div class="card">
        <b style="color:#d4af37; font-size: 13px;">üèÜ RANKING G√âNESIS (V11)</b>
        <div id="rankList" style="margin-top:15px; font-size: 14px;">A ligar √† rede limpa...</div>
    </div>

    <script>
        let balance = 0; // Come√ßa do ZERO absoluto
        let lastClick = 0;
        const cycle = 24 * 60 * 60 * 1000;
        const ratePerSec = 2.0 / 3600;

        function update() {
            const now = Date.now();
            const elapsed = now - lastClick;

            if (lastClick > 0 && elapsed < cycle) {
                balance += ratePerSec;
                document.getElementById('visor').innerText = balance.toFixed(5);
                
                const rem = cycle - elapsed;
                const h = Math.floor(rem / 3600000);
                const m = Math.floor((rem % 3600000) / 60000);
                const s = Math.floor((rem % 60000) / 1000);

                document.getElementById('statusTxt').innerText = "MINERA√á√ÉO ATIVA";
                document.getElementById('statusTxt').style.color = "#00ff00";
                document.getElementById('timer').innerText = `${h}h ${m}m ${s}s restantes`;
                document.getElementById('btnMine').classList.add('active');
                document.getElementById('btnMine').innerText = "‚õèÔ∏è";

                // Sincroniza a cada 15 segundos
                if (Math.floor(now/1000) % 15 === 0 && window.syncToCloud) {
                    window.syncToCloud(balance, true);
                }
            } else {
                document.getElementById('statusTxt').innerText = "SISTEMA OFFLINE";
                document.getElementById('statusTxt').style.color = "#ff4444";
                document.getElementById('timer').innerText = "Toque no K para validar (24h)";
                document.getElementById('btnMine').classList.remove('active');
                document.getElementById('btnMine').innerText = "K";
            }
        }

        document.getElementById('btnMine').onclick = () => {
            if (Date.now() - lastClick >= cycle || lastClick === 0) {
                lastClick = Date.now();
                if(window.syncToCloud) window.syncToCloud(balance, true);
            }
        };

        setInterval(update, 1000);
    </script>
</body>
</html>
