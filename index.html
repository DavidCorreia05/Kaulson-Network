<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kaulson Network | Minera√ß√£o 24h</title>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getFirestore, doc, setDoc, onSnapshot, collection, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyA51GrwiUnvZVbv4Cvz-M", 
        authDomain: "kaulson-network.firebaseapp.com",
        projectId: "kaulson-network",
        storageBucket: "kaulson-network.firebasestorage.app",
        messagingSenderId: "756558405529",
        appId: "1:756558405529:web:999f6fa"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      let userId = localStorage.getItem('kson_id_v8') || 'Minerador_' + Math.floor(Math.random() * 89999 + 10000);
      localStorage.setItem('kson_id_v8', userId);

      window.updateCloud = async (valor) => {
        try {
          await setDoc(doc(db, "ranking", userId), { id: userId, saldo: valor, t: Date.now() }, { merge: true });
        } catch (e) { }
      };

      onSnapshot(query(collection(db, "ranking"), orderBy("saldo", "desc"), limit(5)), (snap) => {
        const list = document.getElementById('rankList');
        list.innerHTML = "";
        snap.forEach(d => {
            const data = d.data();
            list.innerHTML += `<div style="display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #222;">
                <span style="color:${data.id === userId ? '#d4af37' : '#888'}">${data.id}</span>
                <span style="color:#d4af37;font-weight:bold;">${Number(data.saldo).toFixed(5)} $KSON</span>
            </div>`;
        });
      });
    </script>

    <style>
        body { background: #000; color: #fff; font-family: -apple-system, sans-serif; text-align: center; margin: 0; }
        .container { padding: 40px 20px; }
        .balance { font-size: 55px; font-weight: bold; color: #d4af37; margin-top: 10px; }
        .status-box { background: #111; padding: 15px; border-radius: 12px; margin: 20px 0; border: 1px solid #222; }
        .k-btn { 
            width: 200px; height: 200px; border-radius: 50%; border: 10px solid #222;
            background: #d4af37; font-size: 80px; font-weight: bold; cursor: pointer;
            box-shadow: 0 0 40px rgba(212,175,55,0.2); transition: 0.3s;
        }
        .k-btn.active { background: #1a1a1a; color: #d4af37; border-color: #d4af37; pointer-events: none; }
        .card { background: #111; margin: 20px auto; padding: 20px; border-radius: 15px; text-align: left; border: 1px solid #222; max-width: 400px; }
        #timer { color: #d4af37; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <div style="font-size: 12px; color: #666; letter-spacing: 2px;">SALDO DA REDE</div>
        <div class="balance" id="visor">0.00000</div>

        <div class="status-box">
            <div id="statusTxt" style="font-size: 14px; margin-bottom: 5px; color: #ff4444;">MINERA√á√ÉO INATIVA</div>
            <div id="timer">Clique no bot√£o para ativar 24h</div>
        </div>

        <button class="k-btn" id="mainBtn">K</button>

        <div class="card">
            <b style="color:#d4af37; font-size: 12px;">üèÜ RANKING GLOBAL</b>
            <div id="rankList" style="margin-top:15px; font-size: 14px;">A carregar...</div>
        </div>
    </div>

    <script>
        let balance = parseFloat(localStorage.getItem('kson_bal')) || 0;
        let lastClick = parseInt(localStorage.getItem('kson_last_click')) || 0;
        const visor = document.getElementById('visor');
        const mainBtn = document.getElementById('mainBtn');
        const statusTxt = document.getElementById('statusTxt');
        const timer = document.getElementById('timer');

        // REGRA: 2.0 KSON POR HORA = 0.0005555 POR SEGUNDO
        const ratePerSec = 2.0 / 3600;
        const cycle = 24 * 60 * 60 * 1000; // 24 Horas em milissegundos

        function updateUI() {
            const now = Date.now();
            const elapsed = now - lastClick;

            if (lastClick > 0 && elapsed < cycle) {
                // EST√Å A MINERAR
                statusTxt.innerText = "MINERA√á√ÉO ATIVA";
                statusTxt.style.color = "#00ff00";
                mainBtn.classList.add('active');
                mainBtn.innerText = "‚õèÔ∏è";

                // C√°lculo do tempo restante
                const remaining = cycle - elapsed;
                const hours = Math.floor(remaining / (60 * 60 * 1000));
                const mins = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));
                const secs = Math.floor((remaining % (60 * 1000)) / 1000);
                timer.innerText = `Expira em: ${hours}h ${mins}m ${secs}s`;

                // Aumentar o saldo
                balance += ratePerSec;
                visor.innerText = balance.toFixed(5);
                localStorage.setItem('kson_bal', balance);
                
                // Sincroniza com a nuvem a cada 10 segundos
                if (Math.floor(now / 1000) % 10 === 0) {
                    if (window.updateCloud) window.updateCloud(balance);
                }
            } else {
                // PAROU DE MINERAR
                statusTxt.innerText = "MINERA√á√ÉO INATIVA";
                statusTxt.style.color = "#ff4444";
                mainBtn.classList.remove('active');
                mainBtn.innerText = "K";
                timer.innerText = "Clica para validar a tua presen√ßa";
                visor.innerText = balance.toFixed(5);
            }
        }

        mainBtn.onclick = () => {
            const now = Date.now();
            if (now - lastClick >= cycle || lastClick === 0) {
                lastClick = now;
                localStorage.setItem('kson_last_click', lastClick);
                if (window.updateCloud) window.updateCloud(balance);
            }
        };

        // Roda a l√≥gica a cada 1 segundo
        setInterval(updateUI, 1000);
    </script>
</body>
</html>
